steps:
  - task: DotNetCoreCLI@2
    displayName: 'Publish .NET Function App'
    inputs:
      command: 'publish'
      projects: '**/*.csproj'
      publishWebProjects: false
      arguments: '--configuration Release --output $(Build.ArtifactStagingDirectory)'
      zipAfterPublish: true

  - task: AzureFunctionApp@2
    displayName: 'Deploy Function App'
    inputs:
      azureSubscription: $(service_connection)
      appType: 'functionAppLinux'
      appName: $(FunctionAppServiceName)
      package: '$(Build.ArtifactStagingDirectory)/*.zip'

  - task: AzureAppServiceSettings@1
    displayName: 'Update Function App Settings'
    inputs:
      azureSubscription: $(service_connection)
      appName: $(FunctionAppServiceName)
      appSettings: |
        -AppSettings__AzureAppConfiguration__Endpoint $(AppConfigurationEndpoint) 
        -AppSettings__AzureAppConfiguration__IdentityClientID $(AppConfigurationClientID) 
        -AppSettings__QueueName $(EmailNotificationQueueName) 
