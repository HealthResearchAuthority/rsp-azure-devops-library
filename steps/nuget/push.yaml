steps:
  - task: NuGetAuthenticate@1
    displayName: 'NuGet Authenticate'

  - script: |
      find "$(Build.ArtifactStagingDirectory)" -name '*.nupkg' ! -name '*.symbols.nupkg' > nupkg-files.txt
    displayName: 'Find .nupkg files excluding symbols'

  - task: DotNetCoreCLI@2
    displayName: 'Push NuGet packages'
    inputs:
      command: custom
      custom: nuget
      arguments: |
        $(cat nupkg-files.txt | sed 's/^/push /; s/$/ --source $(vstsFeed) --skip-duplicate --api-key AzureDevOps/' | tr '\n' ' ')
