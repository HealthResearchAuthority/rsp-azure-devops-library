steps:
  - checkout: git://Research Systems Programme/rsp-iras-api-tests@main

  - task: Npm@1
    displayName: 'Install Dependencies'
    inputs:
      command: custom
      verbose: false
      customCommand: 'install newman -g'

  - script: |
      npm install -g newman-reporter-html
    displayName: 'Install Dependency to generate HTML report'

  - script: |
      newman run $(System.DefaultWorkingDirectory)/rsp-iras-api-tests/postmancollection/postman_collection.json -r html --reporter-html-export $(System.DefaultWorkingDirectory)/rsp-iras-api-tests/TestResults/API_Test_Report.html
    displayName: 'Run Postman API Tests'

  - task: PublishBuildArtifacts@1
    displayName: Publish API Test Report
    condition: always()
    inputs:
      PathtoPublish: '$(System.DefaultWorkingDirectory)/rsp-iras-api-tests/TestResults'
      ArtifactName: 'API_Test_Report'
      publishLocation: 'Container'