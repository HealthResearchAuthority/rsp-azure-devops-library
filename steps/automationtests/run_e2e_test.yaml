steps:
  - checkout: git://Research Systems Programme/rsp-iras-qa@main

  - task: NodeTool@0
    inputs:
      versionSpec: "20.x"
    displayName: "Install Node.js"

  - script: |
      npm ci
    displayName: "Install Dependencies"

  - script: |
      npx playwright install --with-deps
    displayName: "Install Playwright with Browsers"

  - script: |
      npx bddgen && npx playwright test
    env:
      CONTACT_MANAGER_ONLY_PASS: $(CONTACT_MANAGER_ONLY_PASS)
    displayName: "Run Tests"
    timeoutInMinutes: 10

  - publish: $(System.DefaultWorkingDirectory)/test-reports/playwright
    artifact: playwright-report
    condition: always()
    displayName: Publish Playwright Report

  - publish: $(System.DefaultWorkingDirectory)/test-reports/cucumber
    artifact: cucumber-report
    condition: always()
    displayName: Publish Cucumber Report
