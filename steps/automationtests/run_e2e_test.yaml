parameters:
  browser: "Browser Parameter"

steps:
  - checkout: git://Research Systems Programme/rsp-iras-qa@feature/rsp-757-enable-cross-browser

  - task: NodeTool@0
    inputs:
      versionSpec: "20.x"
    displayName: "Install Node.js"

  - script: |
      echo  'BROWSER PARAM IS: ${{ parameters.browser }}'
      npm ci
    workingDirectory: '$(System.DefaultWorkingDirectory)/rsp-iras-qa/'
    displayName: "Install Dependencies"

  - script: |
      npx playwright install --with-deps
    workingDirectory: '$(System.DefaultWorkingDirectory)/rsp-iras-qa/'
    displayName: "Install Playwright with Browsers"

  - script: |
      npx bddgen && npx playwright test
    workingDirectory: '$(System.DefaultWorkingDirectory)/rsp-iras-qa/'
    env:
      BROWSER: ${{ parameters.browser }}
      CONTACT_MANAGER_ONLY_PASS: $(CONTACT_MANAGER_ONLY_PASS)
      CI: 'true'
    timeoutInMinutes: 10
    displayName: "Run Tests"

  - publish: '$(System.DefaultWorkingDirectory)/rsp-iras-qa/test-reports/playwright'
    artifact: playwright-report
    condition: always()
    displayName: Publish Playwright Report

  - publish: '$(System.DefaultWorkingDirectory)/rsp-iras-qa/test-reports/cucumber'
    artifact: cucumber-report
    condition: always()
    displayName: Publish Cucumber Report
